<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Shoe-catalogue | A Javascript application for a simple shoe ordering system</title>
    <link rel="stylesheet" href="css/styles.css">
    <!-- Handlebars -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.11/handlebars.min.js"></script>
    <!-- lodash -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.10/lodash.min.js"></script>
</head>
<body>
    <div class="container">
        <div class="topbar">
            <h1>Shoe Catalogue App<br><small>A simple javascript shoe catalogue application</small></h1>
        </div>

        <div class="add-shoe">
            <input type="text" class="shoe-brand" placeholder="Brand name">
            <input type="colour" class="shoe-colour" placeholder="Shoe colour">
            <input type="number" class="shoe-size" placeholder="Shoe size">
            <input type="number" class="shoe-price" placeholder="Shoe price">
            <input type="number" class="shoe-qty" placeholder="In stock">
            <button type="submit" class="add-button">Add</button>
        </div>

        <div class="main clearfix">
            <section class="display-area">
                <h2>Choose a product</h2>
                Filter By:<br><br>
                <select name="brand" class="brand-select">
                    <option value="">Choose brand</option>
                    <option value="Nike">Nike</option>
                    <option value="Adidas">Adidas</option>
                    <option value="Puma">Puma</option>
                    <option value="Reebok">Reebok</option>
                </select>
                <select name="brand" class="colour-select">
                    <option value="">Choose colour</option>
                    <option value="Black">Black</option>
                    <option value="White">White</option>
                    <option value="Brown">Brown</option>
                    <option value="Blue">Blue</option>
                </select>
                <select name="size" class="size-select">
                    <option value="">Choose size</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                    <option value="6">6</option>
                    <option value="7">7</option>
                </select>
                <div><button class="open-add-section">Add new item</button></div>
            </section>
            <section class="display-area list-display">
                
                <script type="text/x-template" class="shoes-template">
                    {{#each context}}
                    <div class="shoe clearfix">
                        <table>
                            <tr>
                                <td><b>Brand:</b></td> <td>{{brand}}</td> 
                            </tr>
                            <tr>
                                <td><b>Colour:</b></td> <td>{{colour}}</td>
                            </tr>
                            <tr>
                                <td><b>Size:</b></td> <td>{{size}}</td>
                            </tr>
                            <tr>
                                <td><b>Price:</b></td> <td>{{price}}</td>
                            </tr>
                            <tr>
                                <td><b>Qty:</b></td> <td>{{qty}}</td>
                            </tr>
                        </table>
                        <!-- // Buy button -->
                        <!-- <aside class="item-image"></aside> -->
                        <button class"buy-btn"  id="{{id}}" onclick="searchString(this)">Buy</button>
                    </div>
                    {{/each}}
                </script>

            </section>
        </div>
    </div>
    <script src="js/shoe-catalogue.factory.js"></script>

<script>

// Buttons
var shoeAdd = document.querySelector('.add-shoe');
var btnBuy = document.querySelector('.buy-btn');
var btnAddItem = document.querySelector('.add-button');
var btnAddSection = document.querySelector('.open-add-section');

// New shoe inputs
var brandElem = document.querySelector('.shoe-brand');
var colourElem = document.querySelector('.shoe-colour');
var sizeElem = document.querySelector('.shoe-size');
var priceElem = document.querySelector('.shoe-price');
var qtyElem = document.querySelector('.shoe-qty');

// selects / filter
var brandSelect = document.querySelector('.brand-select');
var colourSelect = document.querySelector('.colour-select');
var sizeSelect = document.querySelector('.size-select');

// template setup
let templateSource = document.querySelector('.shoes-template').innerHTML;
const SHOE_TEMPLATE = Handlebars.compile(templateSource);

var displayElem = document.querySelector('.list-display');

// get stored data
var storedShoes = localStorage.getItem('AVAILABLE_SHOES') ? JSON.parse(localStorage.getItem('AVAILABLE_SHOES')) : [];
// instance
var shoes = ShoeCatalogue(storedShoes);

function filterEvent() {
    let params = {};

    if (brandSelect.value !== '') {
        params.brand = brandSelect.value;
    }

    if (colourSelect.value !== '') {
        params.colour = colourSelect.value;
    }

    if (sizeSelect.value !== '') {
        params.size = sizeSelect.value;
    }

    //shoes.filterBy(params);
    displayElem.innerHTML = SHOE_TEMPLATE({context:shoes.filterBy(params)})
}

function searchString(elem) {
    shoes.toCart(elem.id);
    console.log(shoes.cart());
    
}
window.addEventListener('DOMContentLoaded', function(){
    displayElem.innerHTML = SHOE_TEMPLATE({context:shoes.map()});
})

btnAddSection.addEventListener('click', function(){
    shoeAdd.classList.toggle('show');
})

btnAddItem.addEventListener('click', function() {
    shoes.new(
        brandElem.value,
        colourElem.value,
        sizeElem.value,
        priceElem.value,
        qtyElem.value
    );
    localStorage.setItem('AVAILABLE_SHOES', JSON.stringify(shoes.map()));
});

brandSelect.addEventListener('change', filterEvent);
colourSelect.addEventListener('change', filterEvent); 
sizeSelect.addEventListener('change', filterEvent);

</script>
</body>
</html>

